<div
    class="sticky bottom-0 left-0 mx-2 transform transition-transform duration-500 p-2"
>
    <div
        class="bg-slate-950/90 border border-slate-700/60 backdrop-blur-md shadow-lg text-white rounded-xl"
    >
        <!-- ================= MOBILE (sm trở xuống) ================= -->
        <div class="flex flex-col p-3 md:hidden">
            <!-- Row 1: Thumbnail + Info -->
            <div class="flex items-center gap-3 mb-2">
                <img
                    [src]="musicPlayer.song.thumbnail()"
                    alt="thumbnail"
                    class="w-10 h-10 rounded-md object-cover"
                />
                <div class="flex-1 truncate">
                    <p class="text-sm font-semibold truncate">
                        {{ musicPlayer.song.nameOfSong() }}
                    </p>
                    <p class="text-xs text-gray-300 truncate">
                        {{ musicPlayer.song.singer() }}
                    </p>
                </div>
                <!-- Menu (3 chấm) -->
                <button class="text-gray-300 hover:text-white">⋮</button>
            </div>

            <!-- Row 2: Progress -->
            <div class="flex items-center gap-2 mb-2">
                <span class="text-xs w-10 text-right">
                    {{ formatTime(musicPlayer.currentTime()) }}
                </span>
                <input
                    type="range"
                    min="0"
                    [max]="musicPlayer.duration()"
                    [ngModel]="musicPlayer.currentTime()"
                    (ngModelChange)="seekTo($event)"
                    class="w-full h-1.5 rounded-lg appearance-none bg-gray-300 cursor-pointer accent-white"
                />
                <span class="text-xs w-10">
                    {{ formatTime(musicPlayer.duration()) }}
                </span>

                <!-- repeat mode -->
                <button class="text-gray-300 hover:text-white">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        class="size-6"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M12 5.25c1.213 0 2.415.046 3.605.135a3.256 3.256 0 0 1 3.01 3.01c.044.583.077 1.17.1 1.759L17.03 8.47a.75.75 0 1 0-1.06 1.06l3 3a.75.75 0 0 0 1.06 0l3-3a.75.75 0 0 0-1.06-1.06l-1.752 1.751c-.023-.65-.06-1.296-.108-1.939a4.756 4.756 0 0 0-4.392-4.392 49.422 49.422 0 0 0-7.436 0A4.756 4.756 0 0 0 3.89 8.282c-.017.224-.033.447-.046.672a.75.75 0 1 0 1.497.092c.013-.217.028-.434.044-.651a3.256 3.256 0 0 1 3.01-3.01c1.19-.09 2.392-.135 3.605-.135Zm-6.97 6.22a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.752-1.751c.023.65.06 1.296.108 1.939a4.756 4.756 0 0 0 4.392 4.392 49.413 49.413 0 0 0 7.436 0 4.756 4.756 0 0 0 4.392-4.392c.017-.223.032-.447.046-.672a.75.75 0 0 0-1.497-.092c-.013.217-.028.434-.044.651a3.256 3.256 0 0 1-3.01 3.01 47.953 47.953 0 0 1-7.21 0 3.256 3.256 0 0 1-3.01-3.01 47.759 47.759 0 0 1-.1-1.759L6.97 15.53a.75.75 0 0 0 1.06-1.06l-3-3Z"
                            clip-rule="evenodd"
                        />
                    </svg>
                </button>
            </div>

            <!-- Row 3: Controls -->
            <div class="flex items-center justify-between">
                <!-- Volume -->
                <div class="relative inline-block">
                    <!-- Nút volume -->
                    <button
                        class="flex items-center gap-1 text-xs text-gray-300"
                        (click)="toggleVolumeControl()"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="w-4 h-4"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path d="M3 9v6h4l5 5V4L7 9H3z" />
                        </svg>
                        {{
                            (musicPlayer.volume() * 100).toFixed(0)
                                | number : "3.0-0"
                        }}%
                    </button>

                    <!-- Thanh chỉnh volume -->
                    @if(showVolumeControl) {
                    <div
                        class="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-800 p-2 rounded-lg shadow-lg"
                        (appClickOutside)="showVolumeControl = false"
                    >
                        <input
                            type="range"
                            min="0"
                            max="1"
                            step="0.01"
                            [(ngModel)]="musicPlayer.volume"
                            (input)="setVolume(musicPlayer.volume())"
                            class="w-1 h-24 rounded-lg appearance-none bg-gray-300 cursor-pointer accent-white mobile-input-range"
                        />
                    </div>
                    }
                </div>

                <!-- Controls -->
                <div class="flex items-center gap-6">
                    <button (click)="prevSong()" class="hover:text-gray-300">
                        <svg
                            width="24"
                            height="25"
                            viewBox="0 0 24 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M18.125 6.62502C18.125 6.32168 17.9423 6.0482 17.662 5.93211C17.3818 5.81603 17.0592 5.88019 16.8447 6.09469L10.5947 12.3447C10.3018 12.6376 10.3018 13.1125 10.5947 13.4054L16.8447 19.6554C17.0592 19.8699 17.3818 19.934 17.662 19.8179C17.9423 19.7018 18.125 19.4284 18.125 19.125V6.62502Z"
                                fill="#ffffff"
                            />
                            <path
                                d="M13.4053 7.15535C13.6982 6.86246 13.6982 6.38758 13.4053 6.09469C13.1124 5.8018 12.6376 5.8018 12.3447 6.09469L6.09467 12.3447C5.80178 12.6376 5.80178 13.1125 6.09467 13.4054L12.3447 19.6554C12.6376 19.9482 13.1124 19.9482 13.4053 19.6554C13.6982 19.3625 13.6982 18.8876 13.4053 18.5947L7.68566 12.875L13.4053 7.15535Z"
                                fill="#ffffff"
                            />
                        </svg>
                    </button>

                    @if(musicPlayer.isPlaying()) {
                    <button
                        (click)="togglePlay()"
                        class="text-2xl hover:text-gray-300"
                    >
                        <svg
                            width="25"
                            height="24"
                            viewBox="0 0 25 24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M7 3.25C5.75736 3.25 4.75 4.25736 4.75 5.5V18.4999C4.75 19.7426 5.75736 20.75 7 20.75H8.75C9.99264 20.75 11 19.7426 11 18.4999V5.5C11 4.25736 9.99264 3.25 8.75 3.25H7Z"
                                fill="#ffffff"
                            />
                            <path
                                d="M16.25 3.25C15.0074 3.25 14 4.25736 14 5.5V18.4999C14 19.7426 15.0074 20.75 16.25 20.75H18C19.2426 20.75 20.25 19.7426 20.25 18.4999V5.5C20.25 4.25736 19.2426 3.25 18 3.25H16.25Z"
                                fill="#ffffff"
                            />
                        </svg>
                    </button>
                    } @else {
                    <button
                        (click)="togglePlay()"
                        class="text-2xl hover:text-gray-300"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                            class="size-6"
                        >
                            <path
                                fill-rule="evenodd"
                                d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                                clip-rule="evenodd"
                            />
                        </svg>
                    </button>
                    }

                    <button (click)="nextSong()" class="hover:text-gray-300">
                        <svg
                            width="24"
                            height="25"
                            viewBox="0 0 24 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M7.15533 6.09469C6.94083 5.88019 6.61824 5.81603 6.33799 5.93211C6.05773 6.0482 5.875 6.32168 5.875 6.62502V19.125C5.875 19.4284 6.05773 19.7018 6.33799 19.8179C6.61824 19.934 6.94083 19.8699 7.15533 19.6554L13.4053 13.4054C13.6982 13.1125 13.6982 12.6376 13.4053 12.3447L7.15533 6.09469Z"
                                fill="#ffffff"
                            />
                            <path
                                d="M11.6553 6.09469C11.3624 5.8018 10.8876 5.8018 10.5947 6.09469C10.3018 6.38758 10.3018 6.86246 10.5947 7.15535L16.3143 12.875L10.5947 18.5947C10.3018 18.8876 10.3018 19.3625 10.5947 19.6554C10.8876 19.9482 11.3624 19.9482 11.6553 19.6554L17.9053 13.4054C18.1982 13.1125 18.1982 12.6376 17.9053 12.3447L11.6553 6.09469Z"
                                fill="#ffffff"
                            />
                        </svg>
                    </button>
                </div>

                <!-- Speed -->
                <div class="relative inline-block">
                    <!-- Nút volume -->
                    <button
                        (click)="togglePlayBackRate()"
                        class="text-xs text-gray-300 hover:text-white"
                    >
                        {{
                            musicPlayer.playbackRate().currentRate
                                | number : "1.2-2"
                        }}x
                    </button>

                    <!-- Thanh chỉnh showPlayBackRate -->
                    @if(showPlayBackRate) {
                    <div
                        class="absolute bottom-full mb-2 right-0 bg-slate-900/90 shadow-xl z-50 rounded-2xl border"
                        (appClickOutside)="showPlayBackRate = false"
                    >
                        <div class="w-30 p-4">
                            <div class="grid grid-cols-1 gap-2 text-sm">
                                @for (rate of
                                musicPlayer.playbackRate().listRate; track
                                $index) {
                                <button
                                    class="px-3 py-2 rounded-lg hover:bg-slate-100 hover:text-slate-900 duration-75"
                                    [class.bg-slate-200]="
                                        musicPlayer.playbackRate()
                                            .currentRate === rate
                                    "
                                    [class.text-slate-900]="
                                        musicPlayer.playbackRate()
                                            .currentRate === rate
                                    "
                                    (click)="
                                        musicPlayer.updatePlaybackRate(rate)
                                    "
                                >
                                    {{ rate | number : "1.2-2" }}x
                                </button>
                                }
                            </div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>

        <!-- ================= DESKTOP (md trở lên) ================= -->
        <div class="hidden md:flex items-center gap-4 px-4 py-2">
            <!-- Thumbnail + Info -->
            <div class="flex items-center gap-3 min-w-[200px]">
                <img
                    [src]="musicPlayer.song.thumbnail()"
                    alt="thumbnail"
                    class="w-10 h-10 rounded-lg object-cover"
                />
                <div class="truncate">
                    <p class="text-sm font-semibold truncate max-w-[150px]">
                        {{ musicPlayer.song.nameOfSong() }}
                    </p>
                    <p class="text-xs text-gray-300 truncate max-w-[150px]">
                        {{ musicPlayer.song.singer() }}
                    </p>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-4 flex-shrink-0">
                <button (click)="prevSong()" class="hover:text-gray-300">
                    <svg
                        width="24"
                        height="25"
                        viewBox="0 0 24 25"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M18.125 6.62502C18.125 6.32168 17.9423 6.0482 17.662 5.93211C17.3818 5.81603 17.0592 5.88019 16.8447 6.09469L10.5947 12.3447C10.3018 12.6376 10.3018 13.1125 10.5947 13.4054L16.8447 19.6554C17.0592 19.8699 17.3818 19.934 17.662 19.8179C17.9423 19.7018 18.125 19.4284 18.125 19.125V6.62502Z"
                            fill="#ffffff"
                        />
                        <path
                            d="M13.4053 7.15535C13.6982 6.86246 13.6982 6.38758 13.4053 6.09469C13.1124 5.8018 12.6376 5.8018 12.3447 6.09469L6.09467 12.3447C5.80178 12.6376 5.80178 13.1125 6.09467 13.4054L12.3447 19.6554C12.6376 19.9482 13.1124 19.9482 13.4053 19.6554C13.6982 19.3625 13.6982 18.8876 13.4053 18.5947L7.68566 12.875L13.4053 7.15535Z"
                            fill="#ffffff"
                        />
                    </svg>
                </button>

                @if(musicPlayer.isPlaying()) {
                <button
                    (click)="togglePlay()"
                    class="text-xl hover:text-gray-300"
                >
                    <svg
                        width="25"
                        height="24"
                        viewBox="0 0 25 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M7 3.25C5.75736 3.25 4.75 4.25736 4.75 5.5V18.4999C4.75 19.7426 5.75736 20.75 7 20.75H8.75C9.99264 20.75 11 19.7426 11 18.4999V5.5C11 4.25736 9.99264 3.25 8.75 3.25H7Z"
                            fill="#ffffff"
                        />
                        <path
                            d="M16.25 3.25C15.0074 3.25 14 4.25736 14 5.5V18.4999C14 19.7426 15.0074 20.75 16.25 20.75H18C19.2426 20.75 20.25 19.7426 20.25 18.4999V5.5C20.25 4.25736 19.2426 3.25 18 3.25H16.25Z"
                            fill="#ffffff"
                        />
                    </svg>
                </button>
                } @else {
                <button
                    (click)="togglePlay()"
                    class="text-xl hover:text-gray-300"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        class="size-6"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                            clip-rule="evenodd"
                        />
                    </svg>
                </button>
                }

                <button (click)="nextSong()" class="hover:text-gray-300">
                    <svg
                        width="24"
                        height="25"
                        viewBox="0 0 24 25"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M7.15533 6.09469C6.94083 5.88019 6.61824 5.81603 6.33799 5.93211C6.05773 6.0482 5.875 6.32168 5.875 6.62502V19.125C5.875 19.4284 6.05773 19.7018 6.33799 19.8179C6.61824 19.934 6.94083 19.8699 7.15533 19.6554L13.4053 13.4054C13.6982 13.1125 13.6982 12.6376 13.4053 12.3447L7.15533 6.09469Z"
                            fill="#ffffff"
                        />
                        <path
                            d="M11.6553 6.09469C11.3624 5.8018 10.8876 5.8018 10.5947 6.09469C10.3018 6.38758 10.3018 6.86246 10.5947 7.15535L16.3143 12.875L10.5947 18.5947C10.3018 18.8876 10.3018 19.3625 10.5947 19.6554C10.8876 19.9482 11.3624 19.9482 11.6553 19.6554L17.9053 13.4054C18.1982 13.1125 18.1982 12.6376 17.9053 12.3447L11.6553 6.09469Z"
                            fill="#ffffff"
                        />
                    </svg>
                </button>

                <!-- Speed -->
                <div class="relative inline-block">
                    <!-- Nút volume -->
                    <button
                        (click)="togglePlayBackRate()"
                        class="text-gray-300 hover:text-white"
                    >
                        {{
                            musicPlayer.playbackRate().currentRate
                                | number : "1.2-2"
                        }}x
                    </button>

                    <!-- Thanh chỉnh showPlayBackRate -->
                    @if(showPlayBackRate) {
                    <div
                        class="absolute bottom-full mb-2 right-0 bg-slate-900/90 shadow-xl z-50 rounded-2xl border"
                        (appClickOutside)="showPlayBackRate = false"
                    >
                        <div class="w-30 p-4">
                            <div class="grid grid-cols-1 gap-2 text-sm">
                                @for (rate of
                                musicPlayer.playbackRate().listRate; track
                                $index) {
                                <button
                                    class="px-3 py-2 rounded-lg hover:bg-slate-100 hover:text-slate-900 duration-75"
                                    [class.bg-slate-200]="
                                        musicPlayer.playbackRate()
                                            .currentRate === rate
                                    "
                                    [class.text-slate-900]="
                                        musicPlayer.playbackRate()
                                            .currentRate === rate
                                    "
                                    (click)="
                                        musicPlayer.updatePlaybackRate(rate)
                                    "
                                >
                                    {{ rate | number : "1.2-2" }}x
                                </button>
                                }
                            </div>
                        </div>
                    </div>
                    }
                </div>

                <!-- repeat mode -->
                <button class="text-gray-300 hover:text-white">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        class="size-6"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M12 5.25c1.213 0 2.415.046 3.605.135a3.256 3.256 0 0 1 3.01 3.01c.044.583.077 1.17.1 1.759L17.03 8.47a.75.75 0 1 0-1.06 1.06l3 3a.75.75 0 0 0 1.06 0l3-3a.75.75 0 0 0-1.06-1.06l-1.752 1.751c-.023-.65-.06-1.296-.108-1.939a4.756 4.756 0 0 0-4.392-4.392 49.422 49.422 0 0 0-7.436 0A4.756 4.756 0 0 0 3.89 8.282c-.017.224-.033.447-.046.672a.75.75 0 1 0 1.497.092c.013-.217.028-.434.044-.651a3.256 3.256 0 0 1 3.01-3.01c1.19-.09 2.392-.135 3.605-.135Zm-6.97 6.22a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.752-1.751c.023.65.06 1.296.108 1.939a4.756 4.756 0 0 0 4.392 4.392 49.413 49.413 0 0 0 7.436 0 4.756 4.756 0 0 0 4.392-4.392c.017-.223.032-.447.046-.672a.75.75 0 0 0-1.497-.092c-.013.217-.028.434-.044.651a3.256 3.256 0 0 1-3.01 3.01 47.953 47.953 0 0 1-7.21 0 3.256 3.256 0 0 1-3.01-3.01 47.759 47.759 0 0 1-.1-1.759L6.97 15.53a.75.75 0 0 0 1.06-1.06l-3-3Z"
                            clip-rule="evenodd"
                        />
                    </svg>
                </button>
            </div>

            <!-- Progress Bar -->
            <div class="flex items-center gap-2 w-full px-4">
                <span>{{ formatTime(musicPlayer.currentTime()) }}</span>
                <input
                    type="range"
                    min="0"
                    [max]="musicPlayer.duration()"
                    [ngModel]="musicPlayer.currentTime()"
                    (ngModelChange)="seekTo($event)"
                    class="w-full h-2 rounded-lg appearance-none bg-gray-300 cursor-pointer accent-white"
                />
                <span>{{ formatTime(musicPlayer.duration()) }}</span>
            </div>

            <!-- Volume -->
            <div class="flex items-center gap-3 w-48 flex-shrink-0">
                <input
                    type="range"
                    min="0"
                    max="1"
                    step="0.01"
                    [(ngModel)]="musicPlayer.volume"
                    (input)="setVolume(musicPlayer.volume())"
                    class="w-full h-2 rounded-lg appearance-none bg-gray-300 cursor-pointer accent-white"
                />
                <span
                    class="text-sm text-gray-200 font-medium min-w-[2.5rem] text-right"
                >
                    {{ (musicPlayer.volume() * 100).toFixed(0) }}%
                </span>
            </div>
        </div>
    </div>
</div>
